{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/files_sharing.js","webpack:///./js/app.js","webpack:///./js/sharedfilelist.js","webpack:///./js/sharetabview.js","webpack:///./js/share.js","webpack:///./js/sharebreadcrumbview.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","installedModules","0","__webpack_require__","exports","module","l","e","promises","installedChunkData","promise","Promise","resolve","reject","onScriptComplete","script","document","createElement","charset","timeout","nc","setAttribute","src","p","jsonpScriptSrc","event","onerror","onload","clearTimeout","chunk","errorType","type","realSrc","target","error","Error","request","undefined","setTimeout","head","appendChild","all","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","oe","err","console","jsonpArray","window","oldJsonpFunction","slice","s","__webpack_nonce__","btoa","OC","requestToken","__webpack_public_path__","linkTo","OCP","Collaboration","registerType","action","dialogs","filepicker","f","Files","getClient","getFileInfo","then","status","fileInfo","id","typeString","typeIconClass","OCA","Sharing","App","_inFileList","_outFileList","_overviewFileList","initSharingIn","$el","this","FileList","sharedWithUser","fileActions","_createFileActions","config","getFilesConfig","shown","_extendFileList","appName","find","html","initSharingOut","initSharingLinks","_linkFileList","linksOnly","initSharingDeleted","_deletedFileList","showDeleted","_restoreShareAction","initShareingOverview","isOverview","removeSharingIn","$fileList","empty","removeSharingOut","removeSharingLinks","removeSharingDeleted","removeSharingOverview","destroy","off","_onActionsUpdated","_globalActionsInitialized","FileActions","registerDefaultActions","merge","_","on","register","PERMISSION_READ","filename","context","setActiveView","silent","fileList","changeDirectory","joinPaths","$file","attr","setDefault","registerAction","displayName","altText","mime","permissions","PERMISSION_ALL","iconClass","TYPE_INLINE","actionHandler","fileName","shareId","$","post","linkToOCS","success","result","remove","fileInfoModel","attributes","fail","Notification","showTemporary","ev","each","list","defaultAction","fileSummary","ready","options","initialize","extend","_sharedWithUser","_linksOnly","_showDeleted","_clientSideSort","_allowSelection","_isOverview","apply","arguments","initialized","_renderRow","_createRow","fileData","$tr","before","children","pluck","shares","join","shareOwner","permission","parseInt","PERMISSION_DELETE","expirationTimestamp","expiration","moment","valueOf","formatted","text","modifiedColor","Math","round","Date","getTime","Util","formatDate","relativeModifiedDate","td","class","append","title","style","tooltip","placement","setSharedWithUser","state","updateEmptyContent","getCurrentDirectory","toggleClass","isEmpty","addClass","getDirectoryPermissions","updateStorageStatistics","updateRow","reload","showMask","_reloadCall","abort","_setCurrentDir","deletedShares","url","format","include_tags","beforeSend","xhr","setRequestHeader","shared_with_me","remoteShares","ajax","when","callBack","reloadCallback","additionalShares","hideMask","files","ocs","concat","_makeFilesFromShares","_makeFilesFromRemoteShares","setFiles","chain","map","share","file","owner","remote","replace","basename","mountpoint","mtime","mimetype","file_id","path","dirname","tags","Share","SHARE_TYPE_REMOTE","filter","share_type","SHARE_TYPE_LINK","file_source","icon","MimeType","getIconUrl","item_type","share_with","stime","displayname_owner","shareOwnerId","uid_owner","file_target","extraData","targetDisplayName","share_with_displayname","targetShareWithId","reduce","memo","recipient","recipientId","recipients","recipientData","shareTypes","recipientsCount","shareWith","shareWithDisplayName","values","mountType","keys","sort","_sortComparator","ShareTabView","DetailTabView","className","template","params","getLabel","getIcon","render","_this","self","_dialog","model","isUndefined","set","getSharePermissions","itemType","isDirectory","itemSource","possiblePermissions","configModel","ShareConfigModel","shareModel","ShareItemModel","ShareDialogView","fetch","trigger","Resources","vm","Vue","el","h","View","store","Store","toJSON","Client","PROPERTY_SHARE_TYPES","NS_OWNCLOUD","PROPERTY_OWNER_ID","PROPERTY_OWNER_DISPLAY_NAME","attach","oldCreateRow","tr","sharePermissions","actions","Comment","Details","Goto","PERMISSION_UPDATE","JSON","stringify","oldElementToFile","elementToFile","split","oldGetWebdavProperties","_getWebdavProperties","props","filesClient","addFileInfoParser","response","propStat","properties","permissionsProp","PROPERTY_PERMISSIONS","indexOf","shareTypesProp","xmlvalue","namespaceURI","nodeName","textContent","$files","hasLink","hasShares","shareType","SHARE_TYPE_EMAIL","SHARE_TYPE_USER","SHARE_TYPE_GROUP","SHARE_TYPE_CIRCLE","SHARE_TYPE_ROOM","_updateFileActionIcon","sharesLoaded","isNaN","showDetailsView","actionSpec","isDefault","PERMISSION_SHARE","_defaultRenderAction","shareTab","order","findFileEl","hasLinkShares","forEach","_updateFileListDataAttributes","hasUserShares","markFileAsShared","getShareTypes","registerTabView","breadCrumbSharingDetailView","ShareBreadCrumbView","registerBreadCrumbDetailView","mapObject","removeAttr","Plugins","BreadCrumbView","Backbone","tagName","events","click","_dirInfo","_shareTab","dirInfo","removeClass","hide","isShared","show","delegateEvents","_onClick","preventDefault","FileInfoModel","getSharesWithCurrentItem"],"mappings":"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","file":"files_sharing.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t};\n\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n\n\n \t// script path function\n \tfunction jsonpScriptSrc(chunkId) {\n \t\treturn __webpack_require__.p + \"files_sharing.\" + ({}[chunkId]||chunkId) + \".js\"\n \t}\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n \t// This file contains only the entry chunk.\n \t// The chunk loading function for additional chunks\n \t__webpack_require__.e = function requireEnsure(chunkId) {\n \t\tvar promises = [];\n\n\n \t\t// JSONP chunk loading for javascript\n\n \t\tvar installedChunkData = installedChunks[chunkId];\n \t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n \t\t\t// a Promise means \"currently loading\".\n \t\t\tif(installedChunkData) {\n \t\t\t\tpromises.push(installedChunkData[2]);\n \t\t\t} else {\n \t\t\t\t// setup Promise in chunk cache\n \t\t\t\tvar promise = new Promise(function(resolve, reject) {\n \t\t\t\t\tinstalledChunkData = installedChunks[chunkId] = [resolve, reject];\n \t\t\t\t});\n \t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n \t\t\t\t// start chunk loading\n \t\t\t\tvar script = document.createElement('script');\n \t\t\t\tvar onScriptComplete;\n\n \t\t\t\tscript.charset = 'utf-8';\n \t\t\t\tscript.timeout = 120;\n \t\t\t\tif (__webpack_require__.nc) {\n \t\t\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n \t\t\t\t}\n \t\t\t\tscript.src = jsonpScriptSrc(chunkId);\n\n \t\t\t\tonScriptComplete = function (event) {\n \t\t\t\t\t// avoid mem leaks in IE.\n \t\t\t\t\tscript.onerror = script.onload = null;\n \t\t\t\t\tclearTimeout(timeout);\n \t\t\t\t\tvar chunk = installedChunks[chunkId];\n \t\t\t\t\tif(chunk !== 0) {\n \t\t\t\t\t\tif(chunk) {\n \t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n \t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n \t\t\t\t\t\t\tvar error = new Error('Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')');\n \t\t\t\t\t\t\terror.type = errorType;\n \t\t\t\t\t\t\terror.request = realSrc;\n \t\t\t\t\t\t\tchunk[1](error);\n \t\t\t\t\t\t}\n \t\t\t\t\t\tinstalledChunks[chunkId] = undefined;\n \t\t\t\t\t}\n \t\t\t\t};\n \t\t\t\tvar timeout = setTimeout(function(){\n \t\t\t\t\tonScriptComplete({ type: 'timeout', target: script });\n \t\t\t\t}, 120000);\n \t\t\t\tscript.onerror = script.onload = onScriptComplete;\n \t\t\t\tdocument.head.appendChild(script);\n \t\t\t}\n \t\t}\n \t\treturn Promise.all(promises);\n \t};\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/js/dist/\";\n\n \t// on error function for async loading\n \t__webpack_require__.oe = function(err) { console.error(err); throw err; };\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\n__webpack_nonce__ = btoa(OC.requestToken);\n__webpack_public_path__ = OC.linkTo('files_sharing', 'js/dist/');\n\nimport '../js/app';\nimport '../js/sharedfilelist';\nimport '../js/sharetabview';\nimport '../js/share';\nimport '../js/sharebreadcrumbview';\n\nwindow.OCP.Collaboration.registerType('files', {\n\taction: () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tOC.dialogs.filepicker('Link to a file', function (f) {\n\t\t\t\tconst client = OC.Files.getClient();\n\t\t\t\tclient.getFileInfo(f).then((status, fileInfo) => {\n\t\t\t\t\tresolve(fileInfo.id);\n\t\t\t\t}, () => {\n\t\t\t\t\treject();\n\t\t\t\t});\n\t\t\t}, false);\n\t\t});\n\t},\n\t/** used in \"Link to a {typeString}\" */\n\ttypeString: t('files_sharing', 'file'),\n\ttypeIconClass: 'icon-files-dark'\n});\n\nwindow.OCA.Sharing = OCA.Sharing;\n","/*\n * Copyright (c) 2014 Vincent Petry <pvince81@owncloud.com>\n *\n * This file is licensed under the Affero General Public License version 3\n * or later.\n *\n * See the COPYING-README file.\n *\n */\n\nif (!OCA.Sharing) {\n\t/**\n\t * @namespace OCA.Sharing\n\t */\n\tOCA.Sharing = {};\n}\n/**\n * @namespace\n */\nOCA.Sharing.App = {\n\n\t_inFileList: null,\n\t_outFileList: null,\n\t_overviewFileList: null,\n\n\tinitSharingIn: function($el) {\n\t\tif (this._inFileList) {\n\t\t\treturn this._inFileList;\n\t\t}\n\n\t\tthis._inFileList = new OCA.Sharing.FileList(\n\t\t\t$el,\n\t\t\t{\n\t\t\t\tid: 'shares.self',\n\t\t\t\tsharedWithUser: true,\n\t\t\t\tfileActions: this._createFileActions(),\n\t\t\t\tconfig: OCA.Files.App.getFilesConfig(),\n\t\t\t\t// The file list is created when a \"show\" event is handled, so\n\t\t\t\t// it should be marked as \"shown\" like it would have been done\n\t\t\t\t// if handling the event with the file list already created.\n\t\t\t\tshown: true\n\t\t\t}\n\t\t);\n\n\t\tthis._extendFileList(this._inFileList);\n\t\tthis._inFileList.appName = t('files_sharing', 'Shared with you');\n\t\tthis._inFileList.$el.find('#emptycontent').html('<div class=\"icon-shared\"></div>' +\n\t\t\t'<h2>' + t('files_sharing', 'Nothing shared with you yet') + '</h2>' +\n\t\t\t'<p>' + t('files_sharing', 'Files and folders others share with you will show up here') + '</p>');\n\t\treturn this._inFileList;\n\t},\n\n\tinitSharingOut: function($el) {\n\t\tif (this._outFileList) {\n\t\t\treturn this._outFileList;\n\t\t}\n\t\tthis._outFileList = new OCA.Sharing.FileList(\n\t\t\t$el,\n\t\t\t{\n\t\t\t\tid: 'shares.others',\n\t\t\t\tsharedWithUser: false,\n\t\t\t\tfileActions: this._createFileActions(),\n\t\t\t\tconfig: OCA.Files.App.getFilesConfig(),\n\t\t\t\t// The file list is created when a \"show\" event is handled, so\n\t\t\t\t// it should be marked as \"shown\" like it would have been done\n\t\t\t\t// if handling the event with the file list already created.\n\t\t\t\tshown: true\n\t\t\t}\n\t\t);\n\n\t\tthis._extendFileList(this._outFileList);\n\t\tthis._outFileList.appName = t('files_sharing', 'Shared with others');\n\t\tthis._outFileList.$el.find('#emptycontent').html('<div class=\"icon-shared\"></div>' +\n\t\t\t'<h2>' + t('files_sharing', 'Nothing shared yet') + '</h2>' +\n\t\t\t'<p>' + t('files_sharing', 'Files and folders you share will show up here') + '</p>');\n\t\treturn this._outFileList;\n\t},\n\n\tinitSharingLinks: function($el) {\n\t\tif (this._linkFileList) {\n\t\t\treturn this._linkFileList;\n\t\t}\n\t\tthis._linkFileList = new OCA.Sharing.FileList(\n\t\t\t$el,\n\t\t\t{\n\t\t\t\tid: 'shares.link',\n\t\t\t\tlinksOnly: true,\n\t\t\t\tfileActions: this._createFileActions(),\n\t\t\t\tconfig: OCA.Files.App.getFilesConfig(),\n\t\t\t\t// The file list is created when a \"show\" event is handled, so\n\t\t\t\t// it should be marked as \"shown\" like it would have been done\n\t\t\t\t// if handling the event with the file list already created.\n\t\t\t\tshown: true\n\t\t\t}\n\t\t);\n\n\t\tthis._extendFileList(this._linkFileList);\n\t\tthis._linkFileList.appName = t('files_sharing', 'Shared by link');\n\t\tthis._linkFileList.$el.find('#emptycontent').html('<div class=\"icon-public\"></div>' +\n\t\t\t'<h2>' + t('files_sharing', 'No shared links') + '</h2>' +\n\t\t\t'<p>' + t('files_sharing', 'Files and folders you share by link will show up here') + '</p>');\n\t\treturn this._linkFileList;\n\t},\n\n\tinitSharingDeleted: function($el) {\n\t\tif (this._deletedFileList) {\n\t\t\treturn this._deletedFileList;\n\t\t}\n\t\tthis._deletedFileList = new OCA.Sharing.FileList(\n\t\t\t$el,\n\t\t\t{\n\t\t\t\tid: 'shares.deleted',\n\t\t\t\tshowDeleted: true,\n\t\t\t\tsharedWithUser: true,\n\t\t\t\tfileActions: this._restoreShareAction(),\n\t\t\t\tconfig: OCA.Files.App.getFilesConfig(),\n\t\t\t\t// The file list is created when a \"show\" event is handled, so\n\t\t\t\t// it should be marked as \"shown\" like it would have been done\n\t\t\t\t// if handling the event with the file list already created.\n\t\t\t\tshown: true\n\t\t\t}\n\t\t);\n\n\t\tthis._extendFileList(this._deletedFileList);\n\t\tthis._deletedFileList.appName = t('files_sharing', 'Deleted shares');\n\t\tthis._deletedFileList.$el.find('#emptycontent').html('<div class=\"icon-share\"></div>' +\n\t\t\t'<h2>' + t('files_sharing', 'No deleted shares') + '</h2>' +\n\t\t\t'<p>' + t('files_sharing', 'Shares you deleted will show up here') + '</p>');\n\t\treturn this._deletedFileList;\n\t},\n\n\tinitShareingOverview: function($el) {\n\t\tif (this._overviewFileList) {\n\t\t\treturn this._overviewFileList;\n\t\t}\n\t\tthis._overviewFileList = new OCA.Sharing.FileList(\n\t\t\t$el,\n\t\t\t{\n\t\t\t\tid: 'shares.overview',\n\t\t\t\tconfig: OCA.Files.App.getFilesConfig(),\n\t\t\t\tisOverview: true,\n\t\t\t\t// The file list is created when a \"show\" event is handled, so\n\t\t\t\t// it should be marked as \"shown\" like it would have been done\n\t\t\t\t// if handling the event with the file list already created.\n\t\t\t\tshown: true\n\t\t\t}\n\t\t);\n\n\t\tthis._extendFileList(this._overviewFileList);\n\t\tthis._overviewFileList.appName = t('files_sharing', 'Shares');\n\t\tthis._overviewFileList.$el.find('#emptycontent').html('<div class=\"icon-share\"></div>' +\n\t\t\t'<h2>' + t('files_sharing', 'No shares') + '</h2>' +\n\t\t\t'<p>' + t('files_sharing', 'Shares will show up here') + '</p>');\n\t\treturn this._overviewFileList;\n\t},\n\n\tremoveSharingIn: function() {\n\t\tif (this._inFileList) {\n\t\t\tthis._inFileList.$fileList.empty();\n\t\t}\n\t},\n\n\tremoveSharingOut: function() {\n\t\tif (this._outFileList) {\n\t\t\tthis._outFileList.$fileList.empty();\n\t\t}\n\t},\n\n\tremoveSharingLinks: function() {\n\t\tif (this._linkFileList) {\n\t\t\tthis._linkFileList.$fileList.empty();\n\t\t}\n\t},\n\n\tremoveSharingDeleted: function() {\n\t\tif (this._deletedFileList) {\n\t\t\tthis._deletedFileList.$fileList.empty();\n\t\t}\n\t},\n\n\tremoveSharingOverview: function() {\n\t\tif (this._overviewFileList) {\n\t\t\tthis._overviewFileList.$fileList.empty();\n\t\t}\n\t},\n\n\t/**\n\t * Destroy the app\n\t */\n\tdestroy: function() {\n\t\tOCA.Files.fileActions.off('setDefault.app-sharing', this._onActionsUpdated);\n\t\tOCA.Files.fileActions.off('registerAction.app-sharing', this._onActionsUpdated);\n\t\tthis.removeSharingIn();\n\t\tthis.removeSharingOut();\n\t\tthis.removeSharingLinks();\n\t\tthis._inFileList = null;\n\t\tthis._outFileList = null;\n\t\tthis._linkFileList = null;\n\t\tthis._overviewFileList = null;\n\t\tdelete this._globalActionsInitialized;\n\t},\n\n\t_createFileActions: function() {\n\t\t// inherit file actions from the files app\n\t\tvar fileActions = new OCA.Files.FileActions();\n\t\t// note: not merging the legacy actions because legacy apps are not\n\t\t// compatible with the sharing overview and need to be adapted first\n\t\tfileActions.registerDefaultActions();\n\t\tfileActions.merge(OCA.Files.fileActions);\n\n\t\tif (!this._globalActionsInitialized) {\n\t\t\t// in case actions are registered later\n\t\t\tthis._onActionsUpdated = _.bind(this._onActionsUpdated, this);\n\t\t\tOCA.Files.fileActions.on('setDefault.app-sharing', this._onActionsUpdated);\n\t\t\tOCA.Files.fileActions.on('registerAction.app-sharing', this._onActionsUpdated);\n\t\t\tthis._globalActionsInitialized = true;\n\t\t}\n\n\t\t// when the user clicks on a folder, redirect to the corresponding\n\t\t// folder in the files app instead of opening it directly\n\t\tfileActions.register('dir', 'Open', OC.PERMISSION_READ, '', function (filename, context) {\n\t\t\tOCA.Files.App.setActiveView('files', {silent: true});\n\t\t\tOCA.Files.App.fileList.changeDirectory(OC.joinPaths(context.$file.attr('data-path'), filename), true, true);\n\t\t});\n\t\tfileActions.setDefault('dir', 'Open');\n\t\treturn fileActions;\n\t},\n\n\t_restoreShareAction: function() {\n\t\tvar fileActions = new OCA.Files.FileActions();\n\t\tfileActions.registerAction({\n\t\t\tname: 'Restore',\n\t\t\tdisplayName: '',\n\t\t\taltText: t('files_sharing', 'Restore share'),\n\t\t\tmime: 'all',\n\t\t\tpermissions: OC.PERMISSION_ALL,\n\t\t\ticonClass: 'icon-history',\n\t\t\ttype: OCA.Files.FileActions.TYPE_INLINE,\n\t\t\tactionHandler: function(fileName, context) {\n\t\t\t\tvar shareId = context.$file.data('shareId');\n\t\t\t\t$.post(OC.linkToOCS('apps/files_sharing/api/v1/deletedshares', 2) + shareId)\n\t\t\t\t.success(function(result) {\n\t\t\t\t\tcontext.fileList.remove(context.fileInfoModel.attributes.name);\n\t\t\t\t}).fail(function() {\n\t\t\t\t\tOC.Notification.showTemporary(t('files_sharing', 'Something happened. Unable to restore the share.'));\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\treturn fileActions;\n\t},\n\n\t_onActionsUpdated: function(ev) {\n\t\t_.each([this._inFileList, this._outFileList, this._linkFileList], function(list) {\n\t\t\tif (!list) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (ev.action) {\n\t\t\t\tlist.fileActions.registerAction(ev.action);\n\t\t\t} else if (ev.defaultAction) {\n\t\t\t\tlist.fileActions.setDefault(\n\t\t\t\t\tev.defaultAction.mime,\n\t\t\t\t\tev.defaultAction.name\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t},\n\n\t_extendFileList: function(fileList) {\n\t\t// remove size column from summary\n\t\tfileList.fileSummary.$el.find('.filesize').remove();\n\t}\n};\n\n$(document).ready(function() {\n\t$('#app-content-sharingin').on('show', function(e) {\n\t\tOCA.Sharing.App.initSharingIn($(e.target));\n\t});\n\t$('#app-content-sharingin').on('hide', function() {\n\t\tOCA.Sharing.App.removeSharingIn();\n\t});\n\t$('#app-content-sharingout').on('show', function(e) {\n\t\tOCA.Sharing.App.initSharingOut($(e.target));\n\t});\n\t$('#app-content-sharingout').on('hide', function() {\n\t\tOCA.Sharing.App.removeSharingOut();\n\t});\n\t$('#app-content-sharinglinks').on('show', function(e) {\n\t\tOCA.Sharing.App.initSharingLinks($(e.target));\n\t});\n\t$('#app-content-sharinglinks').on('hide', function() {\n\t\tOCA.Sharing.App.removeSharingLinks();\n\t});\n\t$('#app-content-deletedshares').on('show', function(e) {\n\t\tOCA.Sharing.App.initSharingDeleted($(e.target));\n\t});\n\t$('#app-content-deletedshares').on('hide', function() {\n\t\tOCA.Sharing.App.removeSharingDeleted();\n\t});\n\t$('#app-content-shareoverview').on('show', function(e) {\n\t\tOCA.Sharing.App.initShareingOverview($(e.target));\n\t});\n\t$('#app-content-shareoverview').on('hide', function() {\n\t\tOCA.Sharing.App.removeSharingOverview();\n\t});\n});\n","/*\n * Copyright (c) 2014 Vincent Petry <pvince81@owncloud.com>\n *\n * This file is licensed under the Affero General Public License version 3\n * or later.\n *\n * See the COPYING-README file.\n *\n */\n(function() {\n\n\t/**\n\t * @class OCA.Sharing.FileList\n\t * @augments OCA.Files.FileList\n\t *\n\t * @classdesc Sharing file list.\n\t * Contains both \"shared with others\" and \"shared with you\" modes.\n\t *\n\t * @param $el container element with existing markup for the #controls\n\t * and a table\n\t * @param [options] map of options, see other parameters\n\t * @param {boolean} [options.sharedWithUser] true to return files shared with\n\t * the current user, false to return files that the user shared with others.\n\t * Defaults to false.\n\t * @param {boolean} [options.linksOnly] true to return only link shares\n\t */\n\tvar FileList = function($el, options) {\n\t\tthis.initialize($el, options);\n\t};\n\tFileList.prototype = _.extend({}, OCA.Files.FileList.prototype,\n\t\t/** @lends OCA.Sharing.FileList.prototype */ {\n\t\tappName: 'Shares',\n\n\t\t/**\n\t\t * Whether the list shows the files shared with the user (true) or\n\t\t * the files that the user shared with others (false).\n\t\t */\n\t\t_sharedWithUser: false,\n\t\t_linksOnly: false,\n\t\t_showDeleted: false,\n\t\t_clientSideSort: true,\n\t\t_allowSelection: false,\n\t\t_isOverview: false,\n\n\t\t/**\n\t\t * @private\n\t\t */\n\t\tinitialize: function($el, options) {\n\t\t\tOCA.Files.FileList.prototype.initialize.apply(this, arguments);\n\t\t\tif (this.initialized) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// TODO: consolidate both options\n\t\t\tif (options && options.sharedWithUser) {\n\t\t\t\tthis._sharedWithUser = true;\n\t\t\t}\n\t\t\tif (options && options.linksOnly) {\n\t\t\t\tthis._linksOnly = true;\n\t\t\t}\n\t\t\tif (options && options.showDeleted) {\n\t\t\t\tthis._showDeleted = true;\n\t\t\t}\n\t\t\tif (options && options.isOverview) {\n\t\t\t\tthis._isOverview = true;\n\t\t\t}\n\t\t},\n\n\t\t_renderRow: function() {\n\t\t\t// HACK: needed to call the overridden _renderRow\n\t\t\t// this is because at the time this class is created\n\t\t\t// the overriding hasn't been done yet...\n\t\t\treturn OCA.Files.FileList.prototype._renderRow.apply(this, arguments);\n\t\t},\n\n\t\t_createRow: function(fileData) {\n\t\t\t// TODO: hook earlier and render the whole row here\n\t\t\tvar $tr = OCA.Files.FileList.prototype._createRow.apply(this, arguments);\n\t\t\t$tr.find('.filesize').remove();\n\t\t\t$tr.find('td.date').before($tr.children('td:first'));\n\t\t\t$tr.find('td.filename input:checkbox').remove();\n\t\t\t$tr.attr('data-share-id', _.pluck(fileData.shares, 'id').join(','));\n\t\t\tif (this._sharedWithUser) {\n\t\t\t\t$tr.attr('data-share-owner', fileData.shareOwner);\n\t\t\t\t$tr.attr('data-mounttype', 'shared-root');\n\t\t\t\tvar permission = parseInt($tr.attr('data-permissions')) | OC.PERMISSION_DELETE;\n\t\t\t\t$tr.attr('data-permissions', permission);\n\t\t\t}\n\t\t\tif (this._showDeleted) {\n\t\t\t\tvar permission = fileData.permissions;\n\t\t\t\t$tr.attr('data-share-permissions', permission);\n\t\t\t}\n\n\t\t\t// add row with expiration date for link only shares - influenced by _createRow of filelist\n\t\t\tif (this._linksOnly) {\n\t\t\t\tvar expirationTimestamp = 0;\n\t\t\t\tif(fileData.shares && fileData.shares[0].expiration !== null) {\n\t\t\t\t\texpirationTimestamp = moment(fileData.shares[0].expiration).valueOf();\n\t\t\t\t}\n\t\t\t\t$tr.attr('data-expiration', expirationTimestamp);\n\n\t\t\t\t// date column (1000 milliseconds to seconds, 60 seconds, 60 minutes, 24 hours)\n\t\t\t\t// difference in days multiplied by 5 - brightest shade for expiry dates in more than 32 days (160/5)\n\t\t\t\tvar modifiedColor = Math.round((expirationTimestamp - (new Date()).getTime()) / 1000 / 60 / 60 / 24 * 5);\n\t\t\t\t// ensure that the brightest color is still readable\n\t\t\t\tif (modifiedColor >= 160) {\n\t\t\t\t\tmodifiedColor = 160;\n\t\t\t\t}\n\n\t\t\t\tvar formatted;\n\t\t\t\tvar text;\n\t\t\t\tif (expirationTimestamp > 0) {\n\t\t\t\t\tformatted = OC.Util.formatDate(expirationTimestamp);\n\t\t\t\t\ttext = OC.Util.relativeModifiedDate(expirationTimestamp);\n\t\t\t\t} else {\n\t\t\t\t\tformatted = t('files_sharing', 'No expiration date set');\n\t\t\t\t\ttext = '';\n\t\t\t\t\tmodifiedColor = 160;\n\t\t\t\t}\n\t\t\t\ttd = $('<td></td>').attr({\"class\": \"date\"});\n\t\t\t\ttd.append($('<span></span>').attr({\n\t\t\t\t\t\t\"class\": \"modified\",\n\t\t\t\t\t\t\"title\": formatted,\n\t\t\t\t\t\t\"style\": 'color:rgb(' + modifiedColor + ',' + modifiedColor + ',' + modifiedColor + ')'\n\t\t\t\t\t}).text(text)\n\t\t\t\t\t\t.tooltip({placement: 'top'})\n\t\t\t\t);\n\n\t\t\t\t$tr.append(td);\n\t\t\t}\n\t\t\treturn $tr;\n\t\t},\n\n\t\t/**\n\t\t * Set whether the list should contain outgoing shares\n\t\t * or incoming shares.\n\t\t *\n\t\t * @param state true for incoming shares, false otherwise\n\t\t */\n\t\tsetSharedWithUser: function(state) {\n\t\t\tthis._sharedWithUser = !!state;\n\t\t},\n\n\t\tupdateEmptyContent: function() {\n\t\t\tvar dir = this.getCurrentDirectory();\n\t\t\tif (dir === '/') {\n\t\t\t\t// root has special permissions\n\t\t\t\tthis.$el.find('#emptycontent').toggleClass('hidden', !this.isEmpty);\n\t\t\t\tthis.$el.find('#filestable thead th').toggleClass('hidden', this.isEmpty);\n\n\t\t\t\t// hide expiration date header for non link only shares\n\t\t\t\tif (!this._linksOnly) {\n\t\t\t\t\tthis.$el.find('th.column-expiration').addClass('hidden');\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tOCA.Files.FileList.prototype.updateEmptyContent.apply(this, arguments);\n\t\t\t}\n\t\t},\n\n\t\tgetDirectoryPermissions: function() {\n\t\t\treturn OC.PERMISSION_READ | OC.PERMISSION_DELETE;\n\t\t},\n\n\t\tupdateStorageStatistics: function() {\n\t\t\t// no op because it doesn't have\n\t\t\t// storage info like free space / used space\n\t\t},\n\n\t\tupdateRow: function($tr, fileInfo, options) {\n\t\t\t// no-op, suppress re-rendering\n\t\t\treturn $tr;\n\t\t},\n\n\t\treload: function() {\n\t\t\tthis.showMask();\n\t\t\tif (this._reloadCall) {\n\t\t\t\tthis._reloadCall.abort();\n\t\t\t}\n\n\t\t\t// there is only root\n\t\t\tthis._setCurrentDir('/', false);\n\n\t\t\tvar promises = [];\n\n\t\t\tvar deletedShares = {\n\t\t\t\turl: OC.linkToOCS('apps/files_sharing/api/v1', 2) + 'deletedshares',\n\t\t\t\t/* jshint camelcase: false */\n\t\t\t\tdata: {\n\t\t\t\t\tformat: 'json',\n\t\t\t\t\tinclude_tags: true\n\t\t\t\t},\n\t\t\t\ttype: 'GET',\n\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\txhr.setRequestHeader('OCS-APIREQUEST', 'true');\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tvar shares = {\n\t\t\t\turl: OC.linkToOCS('apps/files_sharing/api/v1') + 'shares',\n\t\t\t\t/* jshint camelcase: false */\n\t\t\t\tdata: {\n\t\t\t\t\tformat: 'json',\n\t\t\t\t\tshared_with_me: this._sharedWithUser !== false,\n\t\t\t\t\tinclude_tags: true\n\t\t\t\t},\n\t\t\t\ttype: 'GET',\n\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\txhr.setRequestHeader('OCS-APIREQUEST', 'true');\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tvar remoteShares = {\n\t\t\t\turl: OC.linkToOCS('apps/files_sharing/api/v1') + 'remote_shares',\n\t\t\t\t/* jshint camelcase: false */\n\t\t\t\tdata: {\n\t\t\t\t\tformat: 'json',\n\t\t\t\t\tinclude_tags: true\n\t\t\t\t},\n\t\t\t\ttype: 'GET',\n\t\t\t\tbeforeSend: function (xhr) {\n\t\t\t\t\txhr.setRequestHeader('OCS-APIREQUEST', 'true');\n\t\t\t\t},\n\t\t\t};\n\n\t\t\t// Add the proper ajax requests to the list and run them\n\t\t\t// and make sure we have 2 promises\n\t\t\tif (this._showDeleted) {\n\t\t\t\tpromises.push($.ajax(deletedShares));\n\t\t\t} else {\n\t\t\t\tpromises.push($.ajax(shares));\n\n\t\t\t\tif (this._sharedWithUser !== false || this._isOverview) {\n\t\t\t\t\tpromises.push($.ajax(remoteShares));\n\t\t\t\t}\n\t\t\t\tif (this._isOverview) {\n\t\t\t\t\tshares.data.shared_with_me = !shares.data.shared_with_me;\n\t\t\t\t\tpromises.push($.ajax(shares));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._reloadCall = $.when.apply($, promises);\n\t\t\tvar callBack = this.reloadCallback.bind(this);\n\t\t\treturn this._reloadCall.then(callBack, callBack);\n\t\t},\n\n\t\treloadCallback: function(shares, remoteShares, additionalShares) {\n\t\t\tdelete this._reloadCall;\n\t\t\tthis.hideMask();\n\n\t\t\tthis.$el.find('#headerSharedWith').text(\n\t\t\t\tt('files_sharing', this._sharedWithUser ? 'Shared by' : 'Shared with')\n\t\t\t);\n\n\t\t\tvar files = [];\n\n\t\t\t// make sure to use the same format\n\t\t\tif (shares[0] && shares[0].ocs) {\n\t\t\t\tshares = shares[0];\n\t\t\t}\n\t\t\tif (remoteShares && remoteShares[0] && remoteShares[0].ocs) {\n\t\t\t\tremoteShares = remoteShares[0];\n\t\t\t}\n\t\t\tif (additionalShares && additionalShares[0] && additionalShares[0].ocs) {\n\t\t\t\tadditionalShares = additionalShares[0];\n\t\t\t}\n\n\t\t\tif (shares.ocs && shares.ocs.data) {\n\t\t\t\tfiles = files.concat(this._makeFilesFromShares(shares.ocs.data, this._sharedWithUser));\n\t\t\t}\n\n\t\t\tif (remoteShares && remoteShares.ocs && remoteShares.ocs.data) {\n\t\t\t\tfiles = files.concat(this._makeFilesFromRemoteShares(remoteShares.ocs.data));\n\t\t\t}\n\n\t\t\tif (additionalShares && additionalShares.ocs && additionalShares.ocs.data) {\n\t\t\t\tfiles = files.concat(this._makeFilesFromShares(additionalShares.ocs.data, !this._sharedWithUser));\n\t\t\t}\n\n\n\t\t\tthis.setFiles(files);\n\t\t\treturn true;\n\t\t},\n\n\t\t_makeFilesFromRemoteShares: function(data) {\n\t\t\tvar files = data;\n\n\t\t\tfiles = _.chain(files)\n\t\t\t\t// convert share data to file data\n\t\t\t\t.map(function(share) {\n\t\t\t\t\tvar file = {\n\t\t\t\t\t\tshareOwner: share.owner + '@' + share.remote.replace(/.*?:\\/\\//g, \"\"),\n\t\t\t\t\t\tname: OC.basename(share.mountpoint),\n\t\t\t\t\t\tmtime: share.mtime * 1000,\n\t\t\t\t\t\tmimetype: share.mimetype,\n\t\t\t\t\t\ttype: share.type,\n\t\t\t\t\t\tid: share.file_id,\n\t\t\t\t\t\tpath: OC.dirname(share.mountpoint),\n\t\t\t\t\t\tpermissions: share.permissions,\n\t\t\t\t\t\ttags: share.tags || []\n\t\t\t\t\t};\n\n\t\t\t\t\tfile.shares = [{\n\t\t\t\t\t\tid: share.id,\n\t\t\t\t\t\ttype: OC.Share.SHARE_TYPE_REMOTE\n\t\t\t\t\t}];\n\t\t\t\t\treturn file;\n\t\t\t\t})\n\t\t\t\t.value();\n\t\t\treturn files;\n\t\t},\n\n\t\t/**\n\t\t * Converts the OCS API share response data to a file info\n\t\t * list\n\t\t * @param {Array} data OCS API share array\n\t\t * @param {bool} sharedWithUser\n\t\t * @return {Array.<OCA.Sharing.SharedFileInfo>} array of shared file info\n\t\t */\n\t\t_makeFilesFromShares: function(data, sharedWithUser) {\n\t\t\t/* jshint camelcase: false */\n\t\t\tvar files = data;\n\n\t\t\tif (this._linksOnly) {\n\t\t\t\tfiles = _.filter(data, function(share) {\n\t\t\t\t\treturn share.share_type === OC.Share.SHARE_TYPE_LINK;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// OCS API uses non-camelcased names\n\t\t\tfiles = _.chain(files)\n\t\t\t\t// convert share data to file data\n\t\t\t\t.map(function(share) {\n\t\t\t\t\t// TODO: use OC.Files.FileInfo\n\t\t\t\t\tvar file = {\n\t\t\t\t\t\tid: share.file_source,\n\t\t\t\t\t\ticon: OC.MimeType.getIconUrl(share.mimetype),\n\t\t\t\t\t\tmimetype: share.mimetype,\n\t\t\t\t\t\ttags: share.tags || []\n\t\t\t\t\t};\n\t\t\t\t\tif (share.item_type === 'folder') {\n\t\t\t\t\t\tfile.type = 'dir';\n\t\t\t\t\t\tfile.mimetype = 'httpd/unix-directory';\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tfile.type = 'file';\n\t\t\t\t\t}\n\t\t\t\t\tfile.share = {\n\t\t\t\t\t\tid: share.id,\n\t\t\t\t\t\ttype: share.share_type,\n\t\t\t\t\t\ttarget: share.share_with,\n\t\t\t\t\t\tstime: share.stime * 1000,\n\t\t\t\t\t\texpiration: share.expiration,\n\t\t\t\t\t};\n\t\t\t\t\tif (sharedWithUser) {\n\t\t\t\t\t\tfile.shareOwner = share.displayname_owner;\n\t\t\t\t\t\tfile.shareOwnerId = share.uid_owner;\n\t\t\t\t\t\tfile.name = OC.basename(share.file_target);\n\t\t\t\t\t\tfile.path = OC.dirname(share.file_target);\n\t\t\t\t\t\tfile.permissions = share.permissions;\n\t\t\t\t\t\tif (file.path) {\n\t\t\t\t\t\t\tfile.extraData = share.file_target;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (share.share_type !== OC.Share.SHARE_TYPE_LINK) {\n\t\t\t\t\t\t\tfile.share.targetDisplayName = share.share_with_displayname;\n\t\t\t\t\t\t\tfile.share.targetShareWithId = share.share_with;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfile.name = OC.basename(share.path);\n\t\t\t\t\t\tfile.path = OC.dirname(share.path);\n\t\t\t\t\t\tfile.permissions = OC.PERMISSION_ALL;\n\t\t\t\t\t\tif (file.path) {\n\t\t\t\t\t\t\tfile.extraData = share.path;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn file;\n\t\t\t\t})\n\t\t\t\t// Group all files and have a \"shares\" array with\n\t\t\t\t// the share info for each file.\n\t\t\t\t//\n\t\t\t\t// This uses a hash memo to cumulate share information\n\t\t\t\t// inside the same file object (by file id).\n\t\t\t\t.reduce(function(memo, file) {\n\t\t\t\t\tvar data = memo[file.id];\n\t\t\t\t\tvar recipient = file.share.targetDisplayName;\n\t\t\t\t\tvar recipientId = file.share.targetShareWithId;\n\t\t\t\t\tif (!data) {\n\t\t\t\t\t\tdata = memo[file.id] = file;\n\t\t\t\t\t\tdata.shares = [file.share];\n\t\t\t\t\t\t// using a hash to make them unique,\n\t\t\t\t\t\t// this is only a list to be displayed\n\t\t\t\t\t\tdata.recipients = {};\n\t\t\t\t\t\tdata.recipientData = {};\n\t\t\t\t\t\t// share types\n\t\t\t\t\t\tdata.shareTypes = {};\n\t\t\t\t\t\t// counter is cheaper than calling _.keys().length\n\t\t\t\t\t\tdata.recipientsCount = 0;\n\t\t\t\t\t\tdata.mtime = file.share.stime;\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// always take the most recent stime\n\t\t\t\t\t\tif (file.share.stime > data.mtime) {\n\t\t\t\t\t\t\tdata.mtime = file.share.stime;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdata.shares.push(file.share);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (recipient) {\n\t\t\t\t\t\t// limit counterparts for output\n\t\t\t\t\t\tif (data.recipientsCount < 4) {\n\t\t\t\t\t\t\t// only store the first ones, they will be the only ones\n\t\t\t\t\t\t\t// displayed\n\t\t\t\t\t\t\tdata.recipients[recipient] = true;\n\t\t\t\t\t\t\tdata.recipientData[data.recipientsCount] = {\n\t\t\t\t\t\t\t\t'shareWith': recipientId,\n\t\t\t\t\t\t\t\t'shareWithDisplayName': recipient\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdata.recipientsCount++;\n\t\t\t\t\t}\n\n\t\t\t\t\tdata.shareTypes[file.share.type] = true;\n\n\t\t\t\t\tdelete file.share;\n\t\t\t\t\treturn memo;\n\t\t\t\t}, {})\n\t\t\t\t// Retrieve only the values of the returned hash\n\t\t\t\t.values()\n\t\t\t\t// Clean up\n\t\t\t\t.each(function(data) {\n\t\t\t\t\t// convert the recipients map to a flat\n\t\t\t\t\t// array of sorted names\n\t\t\t\t\tdata.mountType = 'shared';\n\t\t\t\t\tdelete data.recipientsCount;\n\t\t\t\t\tif (sharedWithUser) {\n\t\t\t\t\t\t// only for outgoing shares\n\t\t\t\t\t\tdelete data.shareTypes;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.shareTypes = _.keys(data.shareTypes);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t// Finish the chain by getting the result\n\t\t\t\t.value();\n\n\t\t\t// Sort by expected sort comparator\n\t\t\treturn files.sort(this._sortComparator);\n\t\t},\n\t});\n\n\t/**\n\t * Share info attributes.\n\t *\n\t * @typedef {Object} OCA.Sharing.ShareInfo\n\t *\n\t * @property {int} id share ID\n\t * @property {int} type share type\n\t * @property {String} target share target, either user name or group name\n\t * @property {int} stime share timestamp in milliseconds\n\t * @property {String} [targetDisplayName] display name of the recipient\n\t * (only when shared with others)\n\t * @property {String} [targetShareWithId] id of the recipient\n\t *\n\t */\n\n\t/**\n\t * Recipient attributes\n\t *\n\t * @typedef {Object} OCA.Sharing.RecipientInfo\n\t * @property {String} shareWith the id of the recipient\n\t * @property {String} shareWithDisplayName the display name of the recipient\n\t */\n\n\t/**\n\t * Shared file info attributes.\n\t *\n\t * @typedef {OCA.Files.FileInfo} OCA.Sharing.SharedFileInfo\n\t *\n\t * @property {Array.<OCA.Sharing.ShareInfo>} shares array of shares for\n\t * this file\n\t * @property {int} mtime most recent share time (if multiple shares)\n\t * @property {String} shareOwner name of the share owner\n\t * @property {Array.<String>} recipients name of the first 4 recipients\n\t * (this is mostly for display purposes)\n\t * @property {Object.<OCA.Sharing.RecipientInfo>} recipientData (as object for easier\n\t * passing to HTML data attributes with jQuery)\n\t */\n\n\tOCA.Sharing.FileList = FileList;\n})();\n","/*\n * Copyright (c) 2015\n *\n * This file is licensed under the Affero General Public License version 3\n * or later.\n *\n * See the COPYING-README file.\n *\n */\n\n/* @global Handlebars */\n\n(function() {\n\tvar TEMPLATE =\n\t\t'<div>' +\n\t\t'<div class=\"dialogContainer\"></div>' +\n\t\t'<div id=\"collaborationResources\"></div>' +\n\t\t'</div>';\n\n\t/**\n\t * @memberof OCA.Sharing\n\t */\n\tvar ShareTabView = OCA.Files.DetailTabView.extend(\n\t\t/** @lends OCA.Sharing.ShareTabView.prototype */ {\n\t\tid: 'shareTabView',\n\t\tclassName: 'tab shareTabView',\n\n\t\ttemplate: function(params) {\n\t\t\treturn \tTEMPLATE;\n\t\t},\n\n\t\tgetLabel: function() {\n\t\t\treturn t('files_sharing', 'Sharing');\n\t\t},\n\n\t\tgetIcon: function() {\n\t\t\treturn 'icon-shared';\n\t\t},\n\n\t\t/**\n\t\t * Renders this details view\n\t\t */\n\t\trender: function() {\n\t\t\tvar self = this;\n\t\t\tif (this._dialog) {\n\t\t\t\t// remove/destroy older instance\n\t\t\t\tthis._dialog.model.off();\n\t\t\t\tthis._dialog.remove();\n\t\t\t\tthis._dialog = null;\n\t\t\t}\n\n\t\t\tif (this.model) {\n\t\t\t\tthis.$el.html(this.template());\n\n\t\t\t\tif (_.isUndefined(this.model.get('sharePermissions'))) {\n\t\t\t\t\tthis.model.set('sharePermissions', OCA.Sharing.Util.getSharePermissions(this.model.attributes));\n\t\t\t\t}\n\n\t\t\t\t// TODO: the model should read these directly off the passed fileInfoModel\n\t\t\t\tvar attributes = {\n\t\t\t\t\titemType: this.model.isDirectory() ? 'folder' : 'file',\n\t\t\t\t   \titemSource: this.model.get('id'),\n\t\t\t\t\tpossiblePermissions: this.model.get('sharePermissions')\n\t\t\t\t};\n\t\t\t\tvar configModel = new OC.Share.ShareConfigModel();\n\t\t\t\tvar shareModel = new OC.Share.ShareItemModel(attributes, {\n\t\t\t\t\tconfigModel: configModel,\n\t\t\t\t\tfileInfoModel: this.model\n\t\t\t\t});\n\t\t\t\tthis._dialog = new OC.Share.ShareDialogView({\n\t\t\t\t\tconfigModel: configModel,\n\t\t\t\t\tmodel: shareModel\n\t\t\t\t});\n\t\t\t\tthis.$el.find('.dialogContainer').append(this._dialog.$el);\n\t\t\t\tthis._dialog.render();\n\t\t\t\tthis._dialog.model.fetch();\n\t\t\t\tthis._dialog.model.on('change', function() {\n\t\t\t\t\tself.trigger('sharesChanged', shareModel);\n\t\t\t\t});\n\n\t\t\t\timport('./../src/collaborationresources').then((Resources) => {\n\t\t\t\t\tvar vm = new Resources.Vue({\n\t\t\t\t\t\tel: '#collaborationResources',\n\t\t\t\t\t\trender: h => h(Resources.View),\n\t\t\t\t\t\tstore: Resources.Store(),\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\tmodel: this.model.toJSON()\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t\tthis.model.on('change', () => { vm.data = this.model.toJSON() })\n\n\t\t\t\t})\n\n\t\t\t} else {\n\t\t\t\tthis.$el.empty();\n\t\t\t\t// TODO: render placeholder text?\n\t\t\t}\n\t\t}\n\t});\n\n\tOCA.Sharing.ShareTabView = ShareTabView;\n})();\n\n","/*\n * Copyright (c) 2014\n *\n * This file is licensed under the Affero General Public License version 3\n * or later.\n *\n * See the COPYING-README file.\n *\n */\n\n(function() {\n\n\t_.extend(OC.Files.Client, {\n\t\tPROPERTY_SHARE_TYPES:\t'{' + OC.Files.Client.NS_OWNCLOUD + '}share-types',\n\t\tPROPERTY_OWNER_ID:\t'{' + OC.Files.Client.NS_OWNCLOUD + '}owner-id',\n\t\tPROPERTY_OWNER_DISPLAY_NAME:\t'{' + OC.Files.Client.NS_OWNCLOUD + '}owner-display-name'\n\t});\n\n\tif (!OCA.Sharing) {\n\t\tOCA.Sharing = {};\n\t}\n\t/**\n\t * @namespace\n\t */\n\tOCA.Sharing.Util = {\n\t\t/**\n\t\t * Initialize the sharing plugin.\n\t\t *\n\t\t * Registers the \"Share\" file action and adds additional\n\t\t * DOM attributes for the sharing file info.\n\t\t *\n\t\t * @param {OCA.Files.FileList} fileList file list to be extended\n\t\t */\n\t\tattach: function(fileList) {\n\t\t\t// core sharing is disabled/not loaded\n\t\t\tif (!OC.Share) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (fileList.id === 'trashbin' || fileList.id === 'files.public') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fileActions = fileList.fileActions;\n\t\t\tvar oldCreateRow = fileList._createRow;\n\t\t\tfileList._createRow = function(fileData) {\n\n\t\t\t\tvar tr = oldCreateRow.apply(this, arguments);\n\t\t\t\tvar sharePermissions = OCA.Sharing.Util.getSharePermissions(fileData);\n\t\t\t\t\n\t\t\t\tif (fileData.permissions === 0) {\n\t\t\t\t\t// no permission, disabling sidebar\n\t\t\t\t\tdelete fileActions.actions.all.Comment;\n\t\t\t\t\tdelete fileActions.actions.all.Details;\n\t\t\t\t\tdelete fileActions.actions.all.Goto;\n\t\t\t\t}\n\t\t\t\ttr.attr('data-share-permissions', sharePermissions);\n\t\t\t\tif (fileData.shareOwner) {\n\t\t\t\t\ttr.attr('data-share-owner', fileData.shareOwner);\n\t\t\t\t\ttr.attr('data-share-owner-id', fileData.shareOwnerId);\n\t\t\t\t\t// user should always be able to rename a mount point\n\t\t\t\t\tif (fileData.mountType === 'shared-root') {\n\t\t\t\t\t\ttr.attr('data-permissions', fileData.permissions | OC.PERMISSION_UPDATE);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (fileData.recipientData && !_.isEmpty(fileData.recipientData)) {\n\t\t\t\t\ttr.attr('data-share-recipient-data', JSON.stringify(fileData.recipientData));\n\t\t\t\t}\n\t\t\t\tif (fileData.shareTypes) {\n\t\t\t\t\ttr.attr('data-share-types', fileData.shareTypes.join(','));\n\t\t\t\t}\n\t\t\t\treturn tr;\n\t\t\t};\n\n\t\t\tvar oldElementToFile = fileList.elementToFile;\n\t\t\tfileList.elementToFile = function($el) {\n\t\t\t\tvar fileInfo = oldElementToFile.apply(this, arguments);\n\t\t\t\tfileInfo.sharePermissions = $el.attr('data-share-permissions') || undefined;\n\t\t\t\tfileInfo.shareOwner = $el.attr('data-share-owner') || undefined;\n\t\t\t\tfileInfo.shareOwnerId = $el.attr('data-share-owner-id') || undefined;\n\n\t\t\t\tif( $el.attr('data-share-types')){\n\t\t\t\t\tfileInfo.shareTypes = $el.attr('data-share-types').split(',');\n\t\t\t\t}\n\n\t\t\t\tif( $el.attr('data-expiration')){\n\t\t\t\t\tvar expirationTimestamp = parseInt($el.attr('data-expiration'));\n\t\t\t\t\tfileInfo.shares = [];\n\t\t\t\t\tfileInfo.shares.push({expiration: expirationTimestamp});\n\t\t\t\t}\n\n\t\t\t\treturn fileInfo;\n\t\t\t};\n\n\t\t\tvar oldGetWebdavProperties = fileList._getWebdavProperties;\n\t\t\tfileList._getWebdavProperties = function() {\n\t\t\t\tvar props = oldGetWebdavProperties.apply(this, arguments);\n\t\t\t\tprops.push(OC.Files.Client.PROPERTY_OWNER_ID);\n\t\t\t\tprops.push(OC.Files.Client.PROPERTY_OWNER_DISPLAY_NAME);\n\t\t\t\tprops.push(OC.Files.Client.PROPERTY_SHARE_TYPES);\n\t\t\t\treturn props;\n\t\t\t};\n\n\t\t\tfileList.filesClient.addFileInfoParser(function(response) {\n\t\t\t\tvar data = {};\n\t\t\t\tvar props = response.propStat[0].properties;\n\t\t\t\tvar permissionsProp = props[OC.Files.Client.PROPERTY_PERMISSIONS];\n\n\t\t\t\tif (permissionsProp && permissionsProp.indexOf('S') >= 0) {\n\t\t\t\t\tdata.shareOwner = props[OC.Files.Client.PROPERTY_OWNER_DISPLAY_NAME];\n\t\t\t\t\tdata.shareOwnerId = props[OC.Files.Client.PROPERTY_OWNER_ID];\n\t\t\t\t}\n\n\t\t\t\tvar shareTypesProp = props[OC.Files.Client.PROPERTY_SHARE_TYPES];\n\t\t\t\tif (shareTypesProp) {\n\t\t\t\t\tdata.shareTypes = _.chain(shareTypesProp).filter(function(xmlvalue) {\n\t\t\t\t\t\treturn (xmlvalue.namespaceURI === OC.Files.Client.NS_OWNCLOUD && xmlvalue.nodeName.split(':')[1] === 'share-type');\n\t\t\t\t\t}).map(function(xmlvalue) {\n\t\t\t\t\t\treturn parseInt(xmlvalue.textContent || xmlvalue.text, 10);\n\t\t\t\t\t}).value();\n\t\t\t\t}\n\n\t\t\t\treturn data;\n\t\t\t});\n\n\t\t\t// use delegate to catch the case with multiple file lists\n\t\t\tfileList.$el.on('fileActionsReady', function(ev){\n\t\t\t\tvar $files = ev.$files;\n\n\t\t\t\t_.each($files, function(file) {\n\t\t\t\t\tvar $tr = $(file);\n\t\t\t\t\tvar shareTypes = $tr.attr('data-share-types') || '';\n\t\t\t\t\tvar shareOwner = $tr.attr('data-share-owner');\n\t\t\t\t\tif (shareTypes || shareOwner) {\n\t\t\t\t\t\tvar hasLink = false;\n\t\t\t\t\t\tvar hasShares = false;\n\t\t\t\t\t\t_.each(shareTypes.split(',') || [], function(shareType) {\n\t\t\t\t\t\t\tshareType = parseInt(shareType, 10);\n\t\t\t\t\t\t\tif (shareType === OC.Share.SHARE_TYPE_LINK) {\n\t\t\t\t\t\t\t\thasLink = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_EMAIL) {\n\t\t\t\t\t\t\t\thasLink = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_USER) {\n\t\t\t\t\t\t\t\thasShares = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_GROUP) {\n\t\t\t\t\t\t\t\thasShares = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_REMOTE) {\n\t\t\t\t\t\t\t\thasShares = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_CIRCLE) {\n\t\t\t\t\t\t\t\thasShares = true;\n\t\t\t\t\t\t\t} else if (shareType === OC.Share.SHARE_TYPE_ROOM) {\n\t\t\t\t\t\t\t\thasShares = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tOCA.Sharing.Util._updateFileActionIcon($tr, hasShares, hasLink);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\n\t\t\tfileList.$el.on('changeDirectory', function() {\n\t\t\t\tOCA.Sharing.sharesLoaded = false;\n\t\t\t});\n\n\t\t\tfileActions.registerAction({\n\t\t\t\tname: 'Share',\n\t\t\t\tdisplayName: '',\n\t\t\t\taltText: t('core', 'Share'),\n\t\t\t\tmime: 'all',\n\t\t\t\tpermissions: OC.PERMISSION_ALL,\n\t\t\t\ticonClass: 'icon-shared',\n\t\t\t\ttype: OCA.Files.FileActions.TYPE_INLINE,\n\t\t\t\tactionHandler: function(fileName, context) {\n\t\t\t\t\t// do not open sidebar if permission is set and equal to 0\n\t\t\t\t\tvar permissions = parseInt(context.$file.data('share-permissions'), 10);\n\t\t\t\t\tif (isNaN(permissions) || permissions > 0) {\n\t\t\t\t\t\tfileList.showDetailsView(fileName, 'shareTabView');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trender: function(actionSpec, isDefault, context) {\n\t\t\t\t\tvar permissions = parseInt(context.$file.data('permissions'), 10);\n\t\t\t\t\t// if no share permissions but share owner exists, still show the link\n\t\t\t\t\tif ((permissions & OC.PERMISSION_SHARE) !== 0 || context.$file.attr('data-share-owner')) {\n\t\t\t\t\t\treturn fileActions._defaultRenderAction.call(fileActions, actionSpec, isDefault, context);\n\t\t\t\t\t}\n\t\t\t\t\t// don't render anything\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tvar shareTab = new OCA.Sharing.ShareTabView('shareTabView', {order: -20});\n\t\t\t// detect changes and change the matching list entry\n\t\t\tshareTab.on('sharesChanged', function(shareModel) {\n\t\t\t\tvar fileInfoModel = shareModel.fileInfoModel;\n\t\t\t\tvar $tr = fileList.findFileEl(fileInfoModel.get('name'));\n\n\t\t\t\t// We count email shares as link share\n\t\t\t\tvar hasLinkShares = shareModel.hasLinkShares();\n\t\t\t\tshareModel.get('shares').forEach(function (share) {\n\t\t\t\t\tif (share.share_type === OC.Share.SHARE_TYPE_EMAIL) {\n\t\t\t\t\t\thasLinkShares = true;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tOCA.Sharing.Util._updateFileListDataAttributes(fileList, $tr, shareModel);\n\t\t\t\tif (!OCA.Sharing.Util._updateFileActionIcon($tr, shareModel.hasUserShares(), hasLinkShares)) {\n\t\t\t\t\t// remove icon, if applicable\n\t\t\t\t\tOC.Share.markFileAsShared($tr, false, false);\n\t\t\t\t}\n\n\t\t\t\t// FIXME: this is too convoluted. We need to get rid of the above updates\n\t\t\t\t// and only ever update the model and let the events take care of rerendering\n\t\t\t\tfileInfoModel.set({\n\t\t\t\t\tshareTypes: shareModel.getShareTypes(),\n\t\t\t\t\t// in case markFileAsShared decided to change the icon,\n\t\t\t\t\t// we need to modify the model\n\t\t\t\t\t// (FIXME: yes, this is hacky)\n\t\t\t\t\ticon: $tr.attr('data-icon')\n\t\t\t\t});\n\t\t\t});\n\t\t\tfileList.registerTabView(shareTab);\n\n\t\t\tvar breadCrumbSharingDetailView = new OCA.Sharing.ShareBreadCrumbView({shareTab: shareTab});\n\t\t\tfileList.registerBreadCrumbDetailView(breadCrumbSharingDetailView);\n\t\t},\n\n\t\t/**\n\t\t * Update file list data attributes\n\t\t */\n\t\t_updateFileListDataAttributes: function(fileList, $tr, shareModel) {\n\t\t\t// files app current cannot show recipients on load, so we don't update the\n\t\t\t// icon when changed for consistency\n\t\t\tif (fileList.id === 'files') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar recipients = _.pluck(shareModel.get('shares'), 'share_with_displayname');\n\t\t\t// note: we only update the data attribute because updateIcon()\n\t\t\tif (recipients.length) {\n\t\t\t\tvar recipientData = _.mapObject(shareModel.get('shares'), function (share) {\n\t\t\t\t\treturn {shareWith: share.share_with, shareWithDisplayName: share.share_with_displayname};\n\t\t\t\t});\n\t\t\t\t$tr.attr('data-share-recipient-data', JSON.stringify(recipientData));\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$tr.removeAttr('data-share-recipient-data');\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Update the file action share icon for the given file\n\t\t *\n\t\t * @param $tr file element of the file to update\n\t\t * @param {boolean} hasUserShares true if a user share exists\n\t\t * @param {boolean} hasLinkShares true if a link share exists\n\t\t *\n\t\t * @return {boolean} true if the icon was set, false otherwise\n\t\t */\n\t\t_updateFileActionIcon: function($tr, hasUserShares, hasLinkShares) {\n\t\t\t// if the statuses are loaded already, use them for the icon\n\t\t\t// (needed when scrolling to the next page)\n\t\t\tif (hasUserShares || hasLinkShares || $tr.attr('data-share-recipient-data') || $tr.attr('data-share-owner')) {\n\t\t\t\tOC.Share.markFileAsShared($tr, true, hasLinkShares);\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\n\t\t/**\n\t\t * @param {Array} fileData\n\t\t * @returns {String}\n\t\t */\n\t\tgetSharePermissions: function(fileData) {\n\t\t\treturn fileData.sharePermissions;\n\t\t}\n\t};\n})();\n\nOC.Plugins.register('OCA.Files.FileList', OCA.Sharing.Util);\n","/* global Handlebars, OC */\n\n/**\n * @copyright 2016 Christoph Wurst <christoph@winzerhof-wurst.at>\n *\n * @author 2016 Christoph Wurst <christoph@winzerhof-wurst.at>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n(function() {\n\t'use strict';\n\n\tvar BreadCrumbView = OC.Backbone.View.extend({\n\t\ttagName: 'span',\n\t\tevents: {\n\t\t\tclick: '_onClick'\n\t\t},\n\t\t_dirInfo: undefined,\n\n\t\t/** @type OCA.Sharing.ShareTabView */\n\t\t_shareTab: undefined,\n\n\t\tinitialize: function(options) {\n\t\t\tthis._shareTab = options.shareTab;\n\t\t},\n\n\t\trender: function(data) {\n\t\t\tthis._dirInfo = data.dirInfo || null;\n\n\t\t\tif (this._dirInfo !== null && (this._dirInfo.path !== '/' || this._dirInfo.name !== '')) {\n\t\t\t\tvar isShared = data.dirInfo && data.dirInfo.shareTypes && data.dirInfo.shareTypes.length > 0;\n\t\t\t\tthis.$el.removeClass('shared icon-public icon-shared');\n\t\t\t\tif (isShared) {\n\t\t\t\t\tthis.$el.addClass('shared');\n\t\t\t\t\tif (data.dirInfo.shareTypes.indexOf(OC.Share.SHARE_TYPE_LINK) !== -1) {\n\t\t\t\t\t\tthis.$el.addClass('icon-public');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.$el.addClass('icon-shared');\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.$el.addClass('icon-shared');\n\t\t\t\t}\n\t\t\t\tthis.$el.show();\n\t\t\t\tthis.delegateEvents();\n\t\t\t} else {\n\t\t\t\tthis.$el.removeClass('shared icon-public icon-shared');\n\t\t\t\tthis.$el.hide();\n\t\t\t}\n\n\t\t\treturn this;\n\t\t},\n\t\t_onClick: function(e) {\n\t\t\te.preventDefault();\n\n\t\t\tvar fileInfoModel = new OCA.Files.FileInfoModel(this._dirInfo);\n\t\t\tvar self = this;\n\t\t\tfileInfoModel.on('change', function() {\n\t\t\t\tself.render({\n\t\t\t\t\tdirInfo: self._dirInfo\n\t\t\t\t});\n\t\t\t});\n\t\t\tthis._shareTab.on('sharesChanged', function(shareModel) {\n\t\t\t\tvar shareTypes = [];\n\t\t\t\tvar shares = shareModel.getSharesWithCurrentItem();\n\n\t\t\t\tfor(var i = 0; i < shares.length; i++) {\n\t\t\t\t\tif (shareTypes.indexOf(shares[i].share_type) === -1) {\n\t\t\t\t\t\tshareTypes.push(shares[i].share_type);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (shareModel.hasLinkShares()) {\n\t\t\t\t\tshareTypes.push(OC.Share.SHARE_TYPE_LINK);\n\t\t\t\t}\n\n\t\t\t\t// Since the dirInfo isn't updated we need to do this dark hackery\n\t\t\t\tself._dirInfo.shareTypes = shareTypes;\n\n\t\t\t\tself.render({\n\t\t\t\t\tdirInfo: self._dirInfo\n\t\t\t\t});\n\t\t\t});\n\t\t\tOCA.Files.App.fileList.showDetailsView(fileInfoModel, 'shareTabView');\n\t\t}\n\t});\n\n\tOCA.Sharing.ShareBreadCrumbView = BreadCrumbView;\n})();\n"],"sourceRoot":""}